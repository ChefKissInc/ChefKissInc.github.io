---
title: ACPI
description: SSDT-таблицы для добавления в EFI вашего Hackintosh.
---

import Aside from '~/components/Aside.astro';

<Aside type="tip">
`Advanced Configuration and Power Interface` (ACPI) — это открытый стандарт, который операционные системы могут использовать для обнаружения и настройки компонентов компьютерного оборудования, управления питанием (например, отключение контроллера USB), автоматической конфигурации (например, Plug and Play, горячая замена) и мониторинга состояния.

Производители могут создавать проверки операционной системы, которые обычно выполняются для отключения некоторых устройств и других функций в ОС, которые они не планируют поддерживать.

Основной таблицей ACPI является `DSDT` (Differentiated System Description Table), определяющая большинство устройств. Затем есть `SSDT` (Secondary System Description Tables), добавляющие дополнительные свойства (например, метод `_PRW` (Power Resources for Wake)), дополнительные устройства, отключающие некоторые устройства на основе условия и т.д.

Большинство прошивок определяют устройства в `DSDT` и используют некоторые `SSDT` для корректировки значений в зависимости от установленного оборудования и/или настроек BIOS. Если вас интересует ACPI, вы можете прочитать спецификацию ACPI, указанную в [спецификациях форума UEFI](https://uefi.org/specifications).

</Aside>

## Загрузка SSDTTime

<Aside type="note" title="Знаете ли вы?">
Раньше эти SSDT приходилось писать вручную, но теперь существуют автоматизированные инструменты для этого процесса. В этом руководстве будет использоваться [`SSDTTime`](https://github.com/corpnewt/SSDTTime).
</Aside>

Так как `SSDTTime` не имеет релизов и является проектом на Python, загрузите исходный код, нажав на `Code`, затем `Download ZIP`.

![SSDTTime download page](~/assets/SSDTTimeDownload.png)

## Запуск SSDTTime

После извлечения архива пользователи Windows должны запустить `SSDTTime.bat`.

Пользователям Linux необходимо открыть терминал в извлеченной директории `SSDTTime`/`SSDTTime-master`, а затем запустить `python3 SSDTTime.py`. **Убедитесь, что у вас установлен Python 3.**

Пользователи macOS должны запустить `SSDTTime.command`.

После запуска инструмента он автоматически загрузит `iASL`, который (де)компилирует таблицы ACPI. Затем вы должны увидеть следующий экран.

![SSDTTime console](~/assets/SSDTTimeConsole.png)

### Указание ACPI целевой системы

Выберите опцию `P` в целевой системе, чтобы выгрузить таблицы ACPI, необходимые для работы `SSDTTime`.

Если вы не запускаете `SSDTTime` на целевой системе, выберите `D`, чтобы указать папку с таблицами ACPI, выгруженными с этой целевой машины.

Программное обеспечение должно теперь отобразить загруженные таблицы ACPI вверху, как на скриншоте ниже.

![SSDTTime](~/assets/SSDTTimeConsole_ACPILoaded.png)

### Генерация SSDT

<Aside type="note">
Большинство этих патчей будут применены только в macOS и не должны вызывать побочных эффектов в других операционных системах
</Aside>

<details>
<summary>Информация о параметрах</summary>

На момент написания доступно 12 параметров

- `FixHPET`

  Исправляет конфликты `IRQ` (Interrupt Request) в таблицах ACPI. Эти конфликты могут привести к неправильной работе некоторых устройств, например, звука.

  <Aside type="danger">
  Не используйте этот параметр на AMD, так как это может причинить больше вреда, чем пользы (неработающий тачпад и т.д.).
  </Aside>

- `FakeEC`

  Создает поддельное устройство встроенного контроллера для правильной работы macOS **и** отключает оригинальный EC.

- `FakeEC Laptop`

  Создает поддельное устройство встроенного контроллера для правильной работы macOS, но **не** отключает оригинальный EC, потому что ноутбукам он нужен для состояния батареи, клавиш FN и т.д.

- `USBX`

  Создает устройство USBX, которое содержит свойства питания USB, необходимые для правильной работы. Это также требует наличия действительного устройства EC.

- `PluginType`

  Устанавливает свойство `plugin-type` в значение `1` на первом ядре процессора, включая `X86PlatformPlugin`, что позволяет управлять питанием процессора и графического процессора (поддержка варьируется).
  Он также переопределяет процессоры с объектами `Processor` вместо объектов `Device`, если это необходимо, поскольку macOS не поддерживает новый стандарт.

- `PMC`

  Определяет устройство `PMCR` в системах, где его нет, чтобы обеспечить поддержку собственного `NVRAM`.

- `RTCAWAC`

  Отключает новый `AWAC` (Alarm Wake ACPI Clock) и включает вместо него `RTC` (Real-Time Clock).

- `USB Reset`

  Отключает устройства `RHUB` в ACPI для всех контроллеров USB, чтобы позволить macOS правильно перечислять порты USB в поврежденных системах ACPI.

- `PCI Bridge`

  Определяет мосты PCI для указанного пути к устройству, так как у некоторых устройств могут быть не определены их мосты PCI, что сделает OpenCore неспособным внедрять свойства с помощью ключа `DeviceProperties` в конфигурации.

- `PNLF`

  Создает поддельное устройство `PNLF` с выбираемым пользователем `_UID` (в основном, профиль, который он использует), чтобы обеспечить собственное управление яркостью на ноутбуках.

  <Aside type="danger">
  На первый взгляд может показаться, что он поддерживает ноутбуки AMD, но это не то же самое, что и на странице [NootedRed](/ru/applehax/nootedred/).
  Используйте тот, что на вышеупомянутой странице.
  </Aside>

- `XOSI`

  Подделывает операционную систему под Windows, позволяя любым периферийным устройствам, заблокированным за пределами macOS, быть активными в macOS.

- `Fix DMAR`

  Удаляет зарезервированные области памяти из таблицы `DMAR`. Это необходимо для получения некоторых устройств, таких как сетевые контроллеры на базе Intel I225, в системах Intel.

  <Aside type="danger">
  Если вы уже используете macOS 12.2.1 и ниже и сетевой контроллер на базе Intel I225, вам нужно будет удалить `e1000=0` или `dk.e1000=0` из ваших параметров загрузки после этого.
  </Aside>

</details>

**_Все_** системы должны выбрать следующие параметры:

- `USBX`,

  Выберите параметр по **умолчанию** (клавиша `B`).

- `RTCAWAC`,

  Если написано, что он вам не нужен, пропустите этот SSDT.

- `PluginType`,
- и `USB Reset`.

Для **_настольных_** систем AMD также необходимо выбрать:

- `FakeEC`.

Для **_ноутбуков_** AMD также необходимо выбрать:

- `FakeEC Laptop`,
- `XOSI`,

  Выберите **по умолчанию** (клавиша `A`)

- и любые SSDT, связанные с подсветкой, указанные на странице [NootedRed](/ru/applehax/nootedred/).

<details>
<summary>Пример процедуры</summary>
На основе ASRock B550m Phantom.

![SSDTTime FakeEC Result](~/assets/SSDTTime_FakeEC_Result.png)
![SSDTTime USBX Prompt](~/assets/SSDTTime_USBX_Prompt.png)
![SSDTTime USBX Result](~/assets/SSDTTime_USBX_Result.png)
![SSDTTime PluginType Result](~/assets/SSDTTime_PluginType_Result.png)
![SSDTTime RTCAWAC Result](~/assets/SSDTTime_RTCAWAC_Result.png)
![SSDTTime USB Reset Result](~/assets/SSDTTime_USBReset_Result.png)
![SSDTTime XOSI Prompt](~/assets/SSDTTime_XOSI_Prompt.png)
![SSDTTime XOSI Result](~/assets/SSDTTime_XOSI_Result.png)

</details>

## Копирование файлов AML из папки Results

Папка `Results` будет выглядеть примерно так после завершения работы.

![SSDTTime Results](~/assets/SSDTTimeResults.png)

Теперь скопируйте все файлы, начинающиеся с `SSDT` и заканчивающиеся на `.aml` внутри корневой папки `Results` в `Drive/EFI/OC/ACPI`.

### Слияние патчей OC с помощью PatchMerge

Наконец, объедините `patches_OC.plist`, используя скрипт `PatchMerge`, включенный в `SSDTTime`. Запустите его так же, как `SSDTTime`.

![PatchMerge](~/assets/PatchMerge.png)

Нажмите `1`, чтобы выбрать `Config.plist`, созданный на предыдущем шаге, затем перетащите ваш `Config.plist` в окно и нажмите Enter.

![PatchMerge after selecting the `Config.plist`](~/assets/PatchMerge_AfterSelect.png)

После этого нажмите `2`, чтобы начать процесс слияния.

![PatchMerge after running the merge process](~/assets/PatchMerge_Result.png)

Измененный `Config.plist` со слитыми патчами появится в папке `Results`.

Проверьте, все ли в порядке, а затем замените ваш оригинальный `Config.plist` на вновь созданный.
